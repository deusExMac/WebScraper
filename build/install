#!/bin/bash


#
#
# TODO: NOT FINISHED!!!!! DOES NOT EXECUTE SUCCESSFULLY!
#
#

#
# Initialize some variables
# related to paths that will be needed.
#

# Directory script is located
SCRIPTDIR=$(dirname $0)

# Directory script is executed from
EXECPATH="$(dirname -- "${BASH_SOURCE[0]}")"
EXECUTIONDIR="$(cd -- "$EXECPATH" && pwd)"



# In the same directory, the colors script
# exists that defines variables for printing
# out colored messages.

source "$SCRIPTDIR"/colors




# The directory where the python virtual environment has been
# created.
# If this is left empty, no virtual environment is setup and installation
# is continued in current context
# NOTE: you cannot have spaces around the = sign
# in bash shell scripts

virtualEnvironmentDir = ""
defaultVirtualEnvironmentDir=" "$EXECUTIONDIR"/shiat" 


while getopts d:a:f: flag
do
    case "${flag}" in
        d) virtualEnvironmentDir=${OPTARG};;
        a) age=${OPTARG};;
        f) fullname=${OPTARG};;
    esac
done

# not needed if there are no positional parameters
#shift $((OPTIND-1))     

if [ ! -z "$virtualEnvironmentDir" ]
then 
   virtualEnvironmentDir="$defaultVirtualEnvironmentDir"
fi


echo "Execution source directory: : "$EXECUTIONDIR" "
echo "Script location: "$SCRIPTDIR""
echo -e "Script working directory: "$PWD" "
printf "Virtual environment directory: "$virtualEnvironmentDir"\n"






printf "\n\n"

if [ -z "$virtualEnvironmentDir" ] 
then
    printf ">>> ${Purple}Executing WITHOUT Virtual environment.${NC}\n"

else

    printf ">>> ${Purple}Executing WITH Virtual environment. Directory: "$virtualEnvironmentDir" ${NC}\n"


    if [ -d "$virtualEnvironmentDir" ] 
    then
        printf ">>> ${Purple}Directory $virtualEnvironmentDir already exists.${NC}\n" 
    else
        printf ">>> ${Purple}Directory $virtualEnvironmentDir does not exists. Creating...${NC}\n"
        python3 -m venv "$virtualEnvironmentDir"
        if [ ! -d "$virtualEnvironmentDir" ] 
        then
            printf ">>> ${Purple}Directory created not found. Script terminating...${NC}"
            exit -2
        fi
        
    fi



    printf ">>> ${Purple}Activating environment "$virtualEnvironmentDir"${NC}"

    # Activate environment. Make sure that this environment exists
    . "$virtualEnvironmentDir"/bin/activate



fi 






# Installing python virtual environment dependencies
printf ">>> ${Purple}Installing module dependencies... ${NC}\n" 
printf ">>> ${BIYellow}"
pip3 install -r "$SCRIPTDIR"/module-requirements.txt
printf "${NC}"

echo -e "\n\nInstallation finished. From the current context, to execute WebScraper:"
echo -e "1) For ${BIYellow}interactive mode${NC}, execute: python webScraper.py . See documentation for optional arguments."
echo -e "2) For ${BIYellow}batch mode${NC}, execute: python webScraper.py -B . See documentation for other optional arguments."
echo -e "3) For ${BIYellow}web mode${NC}, execute: flask --app webApp.py run "

